<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NUTROHUB - Comprehensive Nutrition Guide</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #2196F3;
            --info-color: #00bcd4;
            --warning: #ff9800;
            --danger: #f44336;
            --bg: #f8f9fa;
            --card: #ffffff;
            --text: #333;
            --shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: var(--text); line-height: 1.6; }

        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white; padding: 15px 30px; display: flex;
            justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000; box-shadow: var(--shadow);
        }

        .nav-links { display: flex; gap: 15px; }
        .nav-item { cursor: pointer; padding: 8px 16px; border-radius: 5px; font-weight: 600; transition: 0.3s; font-size: 0.9rem; }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.2); }

        .page-view { display: none; padding: 30px; max-width: 1200px; margin: 0 auto; animation: fadeIn 0.3s ease; min-height: 90vh; }
        .page-view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

       /* Login Page Specific Styles */
        #login-view {
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), 
                        url('https://ik.imagekit.io/yeqo44rng/WhatsApp%20Image%202025-12-18%20at%2000.23.01_9378ce03.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            height: 100vh;
            margin: 0;
            max-width: 100%;
            position: fixed; /* Cover entire screen initially */
            top: 0; left: 0; right: 0;
            z-index: 2000;
        }

        .login-card {
            background: var(--card);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-logo {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .login-title {
            margin-bottom: 25px;
            color: var(--text);
        }

        /* background image for info view */
        #info-view { 
            max-width: 100%;
            background: linear-gradient(rgba(255,255,255,0.8), rgba(255,255,255,0.8)), 
                        url('https://ik.imagekit.io/yeqo44rng/WhatsApp%20Image%202025-12-18%20at%2000.23.01_9378ce03.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        #info-view .card { background: transparent; box-shadow: none; }

        .card { background: var(--card); padding: 25px; border-radius: 12px; box-shadow: var(--shadow); margin-bottom: 20px; }
        .center-card { max-width: 900px; margin: 0 auto; }

        .input-group { margin-bottom: 20px; text-align: left; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        select, input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; transition: border 0.3s; }
        input:focus { border-color: var(--secondary); outline: none; }
        
        button { padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-info { background: var(--info-color); width: 100%; }
        .btn-track { background: var(--primary); flex: 1; }
        .btn-comp { background: var(--secondary); flex: 1; }
        .btn-goto { background: #607d8b; width: 50px; flex: 0 0 50px; }
        .btn-login { background: linear-gradient(135deg, var(--primary), var(--secondary)); width: 100%; padding: 15px; font-size: 1.1rem; }
        .btn-logout { background: var(--danger); }

        .row-group { display: flex; gap: 10px; margin-top: 10px; }

        .food-image-container { 
            width: 100%; 
            max-width: 500px;
            margin: 0 auto 25px auto;
            border-radius: 12px; 
            overflow: hidden; 
            background: #fff;
            box-shadow: var(--shadow);
        }

        .food-image-container img { 
            width: 100%; 
            height: auto; 
            max-height: 350px; 
            display: block; 
            object-fit: contain; 
        }

        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        
        .vitamin-container { 
            background: rgba(255,255,255,0.9); 
            padding: 20px; 
            border-radius: 12px; 
            margin-bottom: 20px; 
            border: 1px dashed var(--secondary);
        }
        .vitamin-tag {
            display: inline-block;
            background: var(--secondary);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin: 4px;
            font-weight: bold;
        }

        .details-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; }
        .detail-box { padding: 15px; border-radius: 8px; border-left: 5px solid; background: rgba(255,255,255,0.9); }
        .benefits { border-color: var(--primary); }
        .effects { border-color: var(--warning); }
        .rec { border-color: var(--secondary); }
        
        .info-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #ddd; }
        .chart-box { height: 280px; background: rgba(255,255,255,0.8); padding: 15px; border-radius: 12px; }

        .table-ui { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 8px; overflow: hidden; }
        .table-ui th, .table-ui td { padding: 15px; border-bottom: 1px solid #eee; text-align: left; }
        .table-ui th { background: #f1f1f1; }

        #toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 25px; border-radius: 20px; opacity: 0; transition: 0.4s; z-index: 3000; }
        
        @media (max-width: 768px) { 
            .info-grid { grid-template-columns: 1fr; } 
            .nav-item { font-size: 0.8rem; padding: 6px 10px; }
        }
    </style>
</head>
<body>

    <!-- Header (Hidden by default via JS until login) -->
    <header id="app-header" style="display: none;">
        <div style="font-size: 1.5rem; font-weight: bold;"><i class="fas fa-heartbeat"></i> NUTROHUB</div>
        <nav class="nav-links">
            <div id="nav-home" class="nav-item active" onclick="switchView('home')">Home</div>
            <div id="nav-info" class="nav-item" onclick="switchView('info')">Nutrition Info</div>
            <div id="nav-tracker" class="nav-item" onclick="switchView('tracker')">Daily Tracker</div>
            <div id="nav-compare" class="nav-item" onclick="switchView('compare')">Compare</div>
            <div class="nav-item" onclick="logout()" style="background: rgba(244, 67, 54, 0.8);"><i class="fas fa-sign-out-alt"></i></div>
        </nav>
    </header>

    <!-- Login View (Shown by default) -->
    <section id="login-view" class="page-view active">
        <div class="login-card">
            <div class="login-logo">
                <i class="fas fa-heartbeat"></i>
            </div>
            <h2 class="login-title">Welcome Back</h2>
            <div class="input-group">
                <label>Username</label>
                <input type="text" id="login-username" placeholder="Enter your username">
            </div>
            <div class="input-group">
                <label>Password</label>
                <input type="password" id="login-password" placeholder="Enter your password">
            </div>
            <button class="btn-login" onclick="handleLogin()">
    <i class="fas fa-lock-open"></i> Login to Dashboard
</button>

<button class="btn-login" style="margin-top:10px; background:#2196F3;" onclick="signupMode ? handleSignup() : handleLogin()">
    <i class="fas fa-user-plus"></i> Create New Account
</button>

            
        </div>
    </section>

    <main>
        <!-- Home View -->
        <main id="home-view" class="page-view">
            <div class="card center-card">
                <h3>Analyze Your Food</h3>
                <div class="input-group">
                    <label>Category</label>
                    <select id="cat" onchange="populateFoods()">
                        <option value="">-- Select Category --</option>
                        <option value="meat">Meat</option>
                        <option value="veggies">Vegetables</option>
                        <option value="fruits">Fruits</option>
                        <option value="dairy">Dairy</option>
                        <option value="nuts">Nuts and Seeds</option>
                        <option value="curries">Curries</option>
                        <option value="fastfood">Fast Food</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Food Item</label>
                    <select id="foodItem" disabled><option value="">Select Category First</option></select>
                </div>
                <div class="input-group">
                    <label>Amount (grams)</label>
                    <input type="number" id="qty" value="100">
                </div>
                
                <div class="action-container">
                    <button class="btn-info" onclick="oneClickInfo()"><i class="fas fa-book-medical"></i> View Full Nutrition Guide</button>
                    <div class="row-group">
                        <button class="btn-track" onclick="saveToTracker()"><i class="fas fa-plus"></i> Add to Tracker</button>
                        <button class="btn-goto" onclick="switchView('tracker')"><i class="fas fa-arrow-right"></i></button>
                    </div>
                    <div class="row-group">
                        <button class="btn-comp" onclick="saveToCompare()"><i class="fas fa-balance-scale"></i> Add to Compare</button>
                        <button class="btn-goto" onclick="switchView('compare')"><i class="fas fa-arrow-right"></i></button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Info View -->
        <section id="info-view" class="page-view">
            <div class="card center-card">
                <h2 id="info-title" style="margin-bottom: 20px; text-align: center;">Detailed Guide</h2>
                
                <div class="food-image-container">
                    <img id="food-img-display" src="" alt="Food Analysis">
                </div>

                <div class="info-grid">
                    <div id="info-stats" style="background: rgba(255,255,255,0.95); padding: 20px; border-radius: 12px; border: 1px solid #ddd;">
                        <p style="color: #888;">Select an item to see analysis.</p>
                    </div>
                    <div class="chart-box">
                        <canvas id="macroChart"></canvas>
                    </div>
                </div>

                <div class="vitamin-container" id="vitamin-list">
                    <strong><i class="fas fa-capsules"></i> Key Vitamins & Minerals:</strong><br>
                    <div id="vitamin-tags-box" style="margin-top: 10px;"></div>
                </div>

                <div class="details-grid" id="health-details"></div>
                
                <div style="text-align: center;">
                    <button class="btn-info" style="margin-top:30px; max-width: 250px; display: inline-flex;" onclick="switchView('home')">Return to Home</button>
                </div>
            </div>
        </section>

        <!-- Tracker View -->
        <section id="tracker-view" class="page-view">
            <div class="card">
                <h3>Daily Tracker</h3>
                <table class="table-ui">
                    <thead><tr><th>Food</th><th>Cal</th><th>Pro</th><th>Carb</th><th>Fat</th></tr></thead>
                    <tbody id="tracker-table-body"></tbody>
                </table>
            </div>
        </section>

        <!-- Compare View -->
        <section id="compare-view" class="page-view">
            <div class="card">
                <h3>Compare Table</h3>
                <table class="table-ui">
                    <thead><tr><th>Item</th><th>Cal</th><th>Pro</th><th>Carb</th><th>Fat</th></tr></thead>
                    <tbody id="compare-table-body"></tbody>
                </table>
            </div>
        </section>
    </main>

    <div id="toast">Added!</div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
/* --- LOGIN LOGIC --- */
let isLoggedIn = false;


async function handleLogin() {
    const u = document.getElementById('login-username').value;
    const p = document.getElementById('login-password').value;

    const res = await fetch("/login", {
        method: "POST",
        credentials: "include",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ username: u, password: p })
    });

    const data = await res.json();

    if(res.ok){
        isLoggedIn = true;
        document.getElementById('login-view').style.display = "none";
        document.getElementById('app-header').style.display = "flex";
        switchView('home');
        showToast("Login successful!");
    } else {
        showToast(data.error);
    }
}


function logout() {
    isLoggedIn = false;
    document.getElementById('app-header').style.display = 'none';
    
    // Show login view again
    const loginView = document.getElementById('login-view');
    loginView.style.display = 'flex'; // Reset flex for centering
    loginView.classList.add('active');
    
    document.getElementById('login-username').value = '';
    document.getElementById('login-password').value = '';
    
    // Hide other views
    document.querySelectorAll('.page-view').forEach(v => {
        if(v.id !== 'login-view') v.classList.remove('active');
    });
    
    showToast("Logged out successfully.");
}

async function handleSignup(username, password) {
    const res = await fetch("/signup", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ username, password })
    });

    const data = await res.json();
    showToast(data.message || data.error);
}

/* --- APP LOGIC --- */

        const foodData = {
            meat: {
                chicken: { name: "Chicken Breast", cal: 165, pro: 31, carb: 0, fat: 3.6, vitamins: ["B6", "B12", "Niacin", "Selenium"], benefits: "Muscle repair.", excess: "Watch sodium.", advice: "Grilled.", img: "https://images.unsplash.com/photo-1604908176997-125f25cc6f3d?w=800" },
                beef: { name: "Beef Steak", cal: 252, pro: 27, carb: 0, fat: 15, vitamins: ["Iron", "Zinc", "B12", "Selenium"], benefits: "Oxygen transport.", excess: "Cholesterol.", advice: "Limit portion.", img: " https://images.unsplash.com/photo-1602470521007-20293bd1fd31?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTF8fGJlZWYlMjBJTUFHRVN8ZW58MHx8MHx8fDA%3D" },
                mutton: { name: "mutton",cal: 230, pro: 25, carb:0, fat: 11, vitamins: ["B12","B3","Potassium","zinc","iron"] , benefits: "healthy fats.", excess: "foodborne illness.", advice: "cook properly.", img: " https://media.istockphoto.com/id/1253934130/photo/mutton-masala-curry-in-plastic-container-for-home-delivery.webp?a=1&b=1&s=612x612&w=0&k=20&c=YfBWKFt3Zje8yRAlAdteLnL5vhJvCnf2Vj2CU2ytgE4=" },
                pork: { name: "pork", cal: 200, pro: 25, carb: 0, fat:10, vitamins: ["B6","B12","zinc"], benefits: "crucial b vitamins.", excess: "high in sodium.", advice: "eat moderately.", img: " https://images.unsplash.com/photo-1677050205812-1fbf1a832efa?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8ODl8fHBvcmslMjBJTUFHRVN8ZW58MHx8MHx8fDA%3D" },
                salmon: { name: "salmon", cal: 180, pro: 20, carb:0, fat:6,vitamins: ["B12","B6","B3","potassium"], benefits: "improves heart and brain health.", excess: "contains heavy mercury.", advice: "choose low mercury fish.", img: " https://plus.unsplash.com/premium_photo-1726873263849-cb94e5c1c065?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MzN8fHNhbG1vbiUyMElNQUdFU3xlbnwwfHwwfHx8MA%3D%3D" },
                tuna: { name: "tuna", cal: 109, pro: 24, carb:0, fat:0.5,vitamins: ["B12","B3","B6","potassium","phosphorus"], benefits: "good for muscle and heart health." ,excess: "risk of mercuric poison.", advice: "avoid high mercury tuna.", img: "https://images.unsplash.com/photo-1625248464253-1b528c1ab7e0?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTl8fHR1bmElMjBJTUFHRVN8ZW58MHx8MHx8fDA%3D " },
                catfish: {name: "catfish", cal: 105, pro:18, carb:0, fat:2.9, vitamins: ["selenium","phosphorus","potassium"], benefits: "good for heart health." ,excess: "risk of mercuric poison.", advice: "eat moderately.", img: "https://images.unsplash.com/photo-1763352358987-cb0886dadf4c?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8N3x8Y2F0JTIwZmlzaCUyMGltYWdlc3xlbnwwfHwwfHx8MA%3D%3D " },
                prawns: { name: "prawns", cal: 99, pro:20, carb:0, fat:0.3, vitamins: ["B12","E","zinc","iron","calcium"], benefits: "increase bone health.", excess: "increases chelestrol.", advice: "eat moderately.", img: " https://media.istockphoto.com/id/2207304015/photo/hot-and-spicy-prawns.webp?a=1&b=1&s=612x612&w=0&k=20&c=LURUE972276J9vWiXzrQRuzH3QtXojuNJsIvUOQcWDw=" }
            },
            veggies: {
                broccoli: { name: "Broccoli", cal: 34, pro: 2.8, carb: 7, fat: 0.4, vitamins: ["C", "K", "Folate"], benefits: "Immune support.", excess: "Bloating.", advice: "Steam lightly.", img: "https://images.unsplash.com/photo-1459411621453-7b03977f4bfc?w=800" },
                carrot: { name: "carrot", cal: 41, pro: 0.9, carb: 9, fat: 0, vitamins: ["A","K","B6","C","B9","potassium","magnesium","iron"], benefits: "improve eyesight and skin health.", excess: "causes carotenemia.", advice: "maintain it balance.", img: "https://images.unsplash.com/photo-1763534315367-db5fe9c0dc79?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8Y2Fycm90JTIwdmVnZXRhYmxlJTIwaW1hZ2VzfGVufDB8fDB8fHww " },
                onion: { name: "onion", cal: 4, pro: 1, carb: 9, fat: 0, vitamins: ["C","B6","B9","potassium","calcium","magnesium"], benefits: "good for digestion.", excess: "cramps.", advice: "use it wisely.", img: "https://plus.unsplash.com/premium_photo-1723914019663-3b802465920e?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MXx8b25pb24lMjB2ZWdldGFibGUlMjBpbWFnZXN8ZW58MHx8MHx8fDA%3D " },
                potato: { name: "potato", cal: 77, pro: 2, carb: 12, fat: 0, vitamins: ["potassium","C","B6","magnesium"], benefits: "it gives instant energy.", excess: "blood sugar increases.", advice: "eat moderately.", img: "https://images.unsplash.com/photo-1655558131320-b7d6d3686e8d?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTl8fHBvdGF0byUyMHZlZ2V0YWJsZSUyMGltYWdlc3xlbnwwfHwwfHx8MA%3D%3D " },
                ladyfinger: { name: "ladyfinger", cal: 33, pro: 3.2, carb: 7, fat: 0, vitamins: ["C","K","B9","A","potassium","calcium","magnesium"], benefits: "helps to maintain blood sugar", excess: "can cause bloating.", advice: "cook properly", img: "https://media.istockphoto.com/id/1194248873/photo/pile-of-ladyfinger-vegetable.webp?a=1&b=1&s=612x612&w=0&k=20&c=O_nk1K-EARDT26a5sF2l2zdV6ZZlGDcA04wdd2-dDmQ= " },
                cauliflower: { name: "cauliflower", cal: 25, pro: 1.9, carb: 5, fat: 0.3, vitamins: ["C","K","B9","potassium","magnesium"], benefits: "reduce cancer issues.", excess: "bloating.", advice: "clean and cook properly", img : "https://media.istockphoto.com/id/1371203923/photo/close-up-of-cauliflower-on-table.webp?a=1&b=1&s=612x612&w=0&k=20&c=DN5buiVXEuXZAmyZ_XI4LjQmecseMbqQtqfNC_Qx8q0= " },
                bittergourd: { name: "bittergourd", cal: 17, pro: 1, carb: 3.7, fiber: 2.8, vitamins: ["C","A","folate","potasium","iron"], benefits: "controls blood sugar and increases immunity.", excess: "causes digestive issues and cramps.", advice: "eat moderately" ,img: "https://media.istockphoto.com/id/2153238640/photo/horizontal-image-of-large-group-of-many-fresh-karele-karela-or-bitter-gourd-vegetable.webp?a=1&b=1&s=612x612&w=0&k=20&c=leShpGl_PqYVHz-vVvN5nHWHf45eMwj98EQv33qwqas= " },
                bottleguard: { name: "bottleguard", cal: 27, pro: 0.6, carb: 3.4, fiber: 1, vitamins: ["C","B6","folate"], benefits: "boosts immunity", excess: "bloating and digestive problems", advice: "clean it thoroughly", img : "https://media.istockphoto.com/id/1194258667/photo/bottle-gourd-for-sale-in-market.webp?a=1&b=1&s=612x612&w=0&k=20&c=fZHiUBNstERZrULCkI9b7cu0hhTKC4iKhYsQ8T72Fvk= " },
                beetroot: { name: "beetroot", cal: 58, pro: 3, carb: 3.8, fiber: 3, vitamins: ["manganeese","potassium","C","K","B9"], benefits: "rich in antioxidants and supports heart health.", excess: "can cause red urine.", advice: " consider potential health.", img: "https://media.istockphoto.com/id/493446908/photo/fresh-sliced-beetroot-on-wooden-surface.webp?a=1&b=1&s=612x612&w=0&k=20&c=JAPVe31lBJa60G7D0EZoylcaVtp4wGIclGKoWHKbVDs= " },
                brinjal: { name: "brinjal", cal: 25, pro:0.9, carb: 6, vitamins: ["C","K","B6"], benefits: "rich in anti oxidants and good for weight management.", excess: "can cause digestive issues and allergies.", advice: " eat moderately.", img : " https://media.istockphoto.com/id/1328668312/photo/whole-eggplant-on-wooden-background.webp?a=1&b=1&s=612x612&w=0&k=20&c=41e1ywWjW-MpbKaFjNQ7LxVlCJ9kP079FMqHPEjmhJI=" }
            },
            fruits: {
                apple: { name: "Apple", cal: 52, pro: 0.3, carb: 14, fat: 0.2, vitamins: ["Vit C", "Fiber", "Potassium"], benefits: "Gut health.", excess: "Fruit sugars.", advice: "Eat with skin.", img: "https://images.unsplash.com/photo-1560806887-1e4cd0b6bcd6?w=800" }
            },
            dairy: {
                milk: { name: "Whole Milk", cal: 61, pro: 3.2, carb: 4.8, fat: 3.3, vitamins: ["Calcium", "Vit D", "B12"], benefits: "Bone strength.", excess: "Lactose.", advice: "Drink cold.", img: "https://images.unsplash.com/photo-1550583724-12558142ab46?w=800" }
            },
            nuts: {
                almonds: { name: "Almonds", cal: 579, pro: 21, carb: 22, fat: 49, vitamins: ["Vit E", "Magnesium", "Manganese"], benefits: "Heart health.", excess: "High calorie.", advice: "Handful daily.", img: "https://images.unsplash.com/photo-1508061253366-f7da158b6d46?w=800" }
            },
            curries: {
                paneer: { name: "Paneer Butter Masala", cal: 220, pro: 9, carb: 12, fat: 16, vitamins: ["Calcium", "Vit A", "B12"], benefits: "Rich in protein.", excess: "High fat content.", advice: "Pair with Roti.", img: "https://images.unsplash.com/photo-1631452180519-c014fe946bc7?w=800" },
                chickenCurry: { name: "Chicken Curry", cal: 180, pro: 18, carb: 6, fat: 10, vitamins: ["Zinc", "B6", "Niacin"], benefits: "Muscle building.", excess: "Spicy; might cause acidity.", advice: "Cook with less oil.", img: "https://images.unsplash.com/photo-1588166524941-3bf61a9c41db?w=800" }
            },
            fastfood: {
                burger: { name: "Beef Burger", cal: 250, pro: 13, carb: 30, fat: 9, vitamins: ["Iron", "B12", "Zinc"], benefits: "Fast energy source.", excess: "High sodium/Processed.", advice: "Avoid extra mayo.", img: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=800" },
                pizza: { name: "Margherita Pizza", cal: 266, pro: 11, carb: 33, fat: 10, vitamins: ["Calcium", "Vit A", "B2"], benefits: "Good Calcium source.", excess: "Refined flour (Gluten).", advice: "Add extra veggies.", img: "https://images.unsplash.com/photo-1574071318508-1cdbad80ad38?w=800" }
            }
        };

        let chart = null;

        function switchView(id) {
            // Security check: if trying to access protected pages without login
            if(!isLoggedIn && id !== 'login') {
                // This shouldn't happen with UI, but logic safety
                return; 
            }

            document.querySelectorAll('.page-view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            const targetView = document.getElementById(id + '-view');
            if(targetView) targetView.classList.add('active');
            
            const targetNav = document.getElementById('nav-' + id);
            if(targetNav) targetNav.classList.add('active');
        }

        function populateFoods() {
            const cat = document.getElementById('cat').value;
            const drop = document.getElementById('foodItem');
            drop.innerHTML = '<option value="">Select Item</option>';
            if(!cat || !foodData[cat]) { drop.disabled = true; return; }
            drop.disabled = false;
            for(let key in foodData[cat]) {
                let opt = document.createElement('option');
                opt.value = key; opt.textContent = foodData[cat][key].name;
                drop.appendChild(opt);
            }
        }

        function getSelectedData() {
            const cat = document.getElementById('cat').value;
            const key = document.getElementById('foodItem').value;
            const qty = document.getElementById('qty').value;
            if(!key) return null;
            const food = foodData[cat][key];
            const factor = qty / 100;
            return {
                name: food.name,
                cal: (food.cal * factor).toFixed(1),
                pro: (food.pro * factor).toFixed(1),
                carb: (food.carb * factor).toFixed(1),
                fat: (food.fat * factor).toFixed(1),
                vitamins: food.vitamins || ["General Minerals"],
                benefits: food.benefits || "N/A",
                excess: food.excess || "N/A",
                advice: food.advice || "N/A",
                img: food.img || "https://images.unsplash.com/photo-1490818387583-1baba5e638af?w=800",
                qty: qty
            };
        }

        function oneClickInfo() {
            const data = getSelectedData();
            if(!data) { showToast("Select food first"); return; }
            
            document.getElementById('info-title').textContent = data.name;
            document.getElementById('food-img-display').src = data.img;
            
            document.getElementById('info-stats').innerHTML = `
                <div class="info-row"><span>Quantity</span><b>${data.qty}g</b></div>
                <div class="info-row"><span>Calories</span><b>${data.cal} kcal</b></div>
                <div class="info-row"><span>Protein</span><b>${data.pro}g</b></div>
                <div class="info-row"><span>Carbs</span><b>${data.carb}g</b></div>
                <div class="info-row"><span>Fat</span><b>${data.fat}g</b></div>
            `;

            const vitaminBox = document.getElementById('vitamin-tags-box');
            vitaminBox.innerHTML = data.vitamins.map(v => <span class="vitamin-tag">${v}</span>).join('');

            document.getElementById('health-details').innerHTML = `
                <div class="detail-box benefits"><strong>Benefits:</strong><br>${data.benefits}</div>
                <div class="detail-box effects"><strong>Excess:</strong><br>${data.excess}</div>
                <div class="detail-box rec"><strong>Advice:</strong><br>${data.advice}</div>
            `;

            switchView('info');
            setTimeout(() => drawChart(data.pro, data.carb, data.fat), 100);
        }

        function saveToTracker() {
            const data = getSelectedData();
            if(!data) { showToast("Select food first"); return; }
            document.getElementById('tracker-table-body').innerHTML += <tr><td>${data.name}</td><td>${data.cal}</td><td>${data.pro}g</td><td>${data.carb}g</td><td>${data.fat}g</td></tr>;
            showToast("Added to Tracker!");
        }

        function saveToCompare() {
            const data = getSelectedData();
            if(!data) { showToast("Select food first"); return; }
            document.getElementById('compare-table-body').innerHTML += <tr><td>${data.name} (${data.qty}g)</td><td>${data.cal}</td><td>${data.pro}g</td><td>${data.carb}g</td><td>${data.fat}g</td></tr>;
            showToast("Added to Comparison!");
        }

        function drawChart(p, c, f) {
            const ctx = document.getElementById('macroChart').getContext('2d');
            if(chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Protein', 'Carbs', 'Fat'],
                    datasets: [{ data: [p, c, f], backgroundColor: ['#4CAF50', '#2196F3', '#FF9800'] }]
                },
                options: { maintainAspectRatio: false }
            });
        }

        function showToast(msg) { const t = document.getElementById('toast'); t.textContent = msg; t.style.opacity = 1; setTimeout(() => t.style.opacity = 0, 2000); }
    </script>
</body>
</html>
